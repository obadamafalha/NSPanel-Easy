---
name: Validate Markdown

# yamllint disable-line rule:truthy
on:
  pull_request:
    paths:
      - '**/*.md'
  push:
    paths:
      - '**/*.md'
  workflow_dispatch:

jobs:
  markdown-lint:
    name: Markdown Lint
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6
        with:
          fetch-depth: '0'

      # https://github.com/marketplace/actions/markdownlint-cli2-action
      - name: Identify changed files
        uses: tj-actions/changed-files@v41
        id: changed-files
        with:
          files: '**/*.md'
          separator: ","
      # https://github.com/marketplace/actions/markdownlint-cli2-action
      - name: Markdown Lint
        uses: DavidAnson/markdownlint-cli2-action@v14
        if: steps.changed-files.outputs.any_changed == 'true'
        with:
          globs: ${{ steps.changed-files.outputs.all_changed_files }}
          separator: ","
          config: '.rules/.markdownlint.jsonc'
          fix: true
      # https://github.com/edwardtfn/NSPanel-Easy/pull/1#pullrequestreview-3730634846
      - name: Commit fixes
        if: steps.changed-files.outputs.any_changed == 'true'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "style: auto-fix markdown lint issues"
          file_pattern: '**/*.md'

  markdown-links:
    name: Check links
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v6
        with:
          fetch-depth: '0'

      # https://github.com/gaurav-nelson/github-action-markdown-link-check
      - name: Markdown links
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          # yamllint disable-line rule:truthy
          check-modified-files-only: yes
          config-file: '.rules/mlc_config.json'
          base-branch: 'main'
...
